<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Eddie's 2025 Results</title>
<style>
body { font-family: Arial; background:#f7f7f7; padding:20px; }
h1 { text-align:center; }
.categories { margin:20px 0; }
.category { background:#fff; padding:15px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.category h2 { margin-top:0; }
.films { margin-left:15px; }
.film-result { margin:5px 0; }
</style>
</head>
<body>
<h1>The Eddie's 2025 Results</h1>
<div id="categories-container" class="categories"></div>

<script type="module">
window.onload = async () => {
  const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm');
  if (!window.supabase) {
    window.supabase = createClient(
      'https://asrydhgpdlpocuapcvuf.supabase.co',
      'sb_publishable_KANIL3DCSWPFVyJjhJ4uYA_38LnWmCu'
    );
  }
  const supabase = window.supabase;

  const categoriesContainer = document.getElementById('categories-container');
  const { data: categoriesData } = await supabase.from('categories').select('*').eq('active', true).order('id');
  const { data: filmsData } = await supabase.from('films').select('*').order('id');

  for (let category of categoriesData) {
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'category';
    categoryDiv.innerHTML = `<h2>${category.name}</h2>`;

    const filmsDiv = document.createElement('div'); filmsDiv.className = 'films';

    for (let film of filmsData) {
      const { count } = await supabase.from('votes').select('*', { count: 'exact' }).eq('category_id', category.id).eq('film_id', film.id);
      const filmResultDiv = document.createElement('div');
      filmResultDiv.className = 'film-result';
      filmResultDiv.textContent = `${film.name}: ${count} vote(s)`;
      filmsDiv.appendChild(filmResultDiv);
    }

    categoryDiv.appendChild(filmsDiv);
    categoriesContainer.appendChild(categoryDiv);
  }
};
</script>
</body>
</html>
