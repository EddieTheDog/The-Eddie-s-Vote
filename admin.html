<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Eddie's 2025 | Admin Panel</title>
<style>
body{ font-family:'Inter',sans-serif; padding:40px; max-width:500px; margin:auto; background:#fff; color:#000;}
h1{ text-align:center; letter-spacing:5px; text-transform:uppercase; }
button{ padding:15px 30px; font-size:16px; margin:10px 0; cursor:pointer; background:#007aff; color:white; border:none; border-radius:5px; }
button:hover{ background:#005bb5;}
.status{ margin-top:20px; font-weight:bold; font-size:1.1rem; }
</style>
</head>
<body>

<h1>Admin Panel</h1>
<p>Toggle voting on/off for The Eddie's 2025</p>
<button id="toggle-btn">Loading...</button>
<div class="status" id="status"></div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabase = createClient(
  'https://asrydhgpdlpocuapcvuf.supabase.co',
  'sb_publishable_KANIL3DCSWPFVyJjhJ4uYA_38LnWmCu'
);

document.addEventListener('DOMContentLoaded', async () => {
  const btn = document.getElementById('toggle-btn');
  const statusDiv = document.getElementById('status');

  async function loadStatus() {
    const { data, error } = await supabase
      .from('settings')
      .select('voting_enabled')
      .eq('id', 1)
      .single();

    if (error || !data) {
      statusDiv.textContent = "Error loading status";
      btn.disabled = true;
      return;
    }

    btn.textContent = data.voting_enabled ? "Disable Voting" : "Enable Voting";
    statusDiv.textContent = data.voting_enabled ? "Voting is currently ENABLED" : "Voting is currently DISABLED";
  }

  btn.addEventListener('click', async () => {
    btn.disabled = true;
    statusDiv.textContent = "Updating...";

    const { data: current } = await supabase
      .from('settings')
      .select('voting_enabled')
      .eq('id', 1)
      .single();

    const newStatus = !current.voting_enabled;

    await supabase
      .from('settings')
      .update({ voting_enabled: newStatus })
      .eq('id', 1);

    await loadStatus();
    btn.disabled = false;
  });

  // Initial load
  await loadStatus();
});
</script>

</body>
</html>
