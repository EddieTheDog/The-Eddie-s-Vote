<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Eddie's 2025 | Results</title>
<style>
body{ font-family: 'Inter', sans-serif; padding:20px; background:#fff; color:#000;}
h1{ letter-spacing:5px; text-transform:uppercase; text-align:center;}
.category{ margin-bottom:30px; }
.winner{ font-weight:bold; color:#007aff;}
.film-votes{ margin-left:20px;}
</style>
</head>
<body>
<h1>The Eddie's 2025 Results</h1>
<div id="results-container"></div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
const supabase = createClient(
    'https://asrydhgpdlpocuapcvuf.supabase.co',
    'sb_publishable_KANIL3DCSWPFVyJjhJ4uYA_38LnWmCu'
);

async function loadResults(){
    const { data: categories } = await supabase.from('categories').select('*').eq('active',true).order('id');
    const { data: films } = await supabase.from('films').select('*').order('name');
    const { data: votes } = await supabase.from('votes').select('*');

    const container = document.getElementById('results-container');

    categories.forEach(cat=>{
        const votesInCat = votes.filter(v=>v.category_id===cat.id);
        const counts = {};
        films.forEach(f=> counts[f.name]=votesInCat.filter(v=>v.film_id===f.id).length);
        const maxVotes = Math.max(...Object.values(counts));
        const winners = Object.keys(counts).filter(f=>counts[f]===maxVotes);

        let html = `<div class="category"><h2>${cat.name}</h2>`;
        html+=`<div class="winner">Winner: ${winners.join(', ')} (${maxVotes} vote(s))</div>`;
        for(const f in counts){
            html+=`<div class="film-votes">${f}: ${counts[f]} vote(s)</div>`;
        }
        html+='</div>';
        container.innerHTML+=html;
    });
}

loadResults();
</script>
</body>
</html>
